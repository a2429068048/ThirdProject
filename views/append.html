<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>发帖</title>
    {{include "./commend.html"}}
    <style>
        textarea {
            display: block;
            width: 100%;
            border: none;
            margin: 0;
            padding: 0;
            min-height: 2.81rem;
            font-size: 0.75rem;
            resize: none;
            outline: none;
            /* border: 0.05rem solid black; */
            box-sizing: border-box;
            border-bottom: 0.05rem solid #ddd;
        }

        .content {
            padding: 0.28rem 0.46rem;
            background-color: white;
            font-size: 0.656rem;
        }

        .imgs {
            padding: 0.937rem 0;
            display: flex;
            flex-wrap: wrap;
        }

        .imgs img {
            width:5.625rem;
            height:5.625rem;
            border-radius: 10%;
            margin-right: 0.3rem;
        }

        .content .imgAppend {
            position: relative;
            width: 5.625rem;
            height: 5.625rem;
            background-color: #ccc;
            border-radius: 10%;
            /* margin: 0.937rem 0; */
            overflow: hidden;
        }

        .content .imgAppend::after,
        .content .imgAppend::before {
            content: "";
            width: 3%;
            height: 50%;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background-color: #888;

        }

        .content .imgAppend::after {
            width: 50%;
            height: 3%;
        }



        .imgs input {
            display: none;
        }



        .topic .topicHead {
            align-items: center;
            font-size: 0.703rem;
            margin: 0.46rem 0;
        }

        .topic .topicHead img {
            width: 0.75rem;
            height: 0.75rem;
            margin-right: 0.18rem;

        }

        .topic .topicHead span:last-child {
            margin-left: 0.468rem;
            color: #999;
        }

        .topic .topics li {
            flex-wrap: wrap;
            /* justify-content: space-around; */
        }

        .topic .topics li span {
            padding: 0.18rem 0.28rem;
            border: 0.05rem solid grey;
            border-radius: 0.23rem;
            margin-bottom: 0.28rem;
            margin-left: 0.375rem;
            color: #999;
            font-size: 0.609rem;
        }

        .topic .topics li span.selected {
            background-color: #999;
            color: white;

        }

        .topic .slide {
            text-align: center;
            margin: 0;
            padding: 0.28rem 0;
            border-bottom: 0.05rem solid #ddd;
        }

        .topic .slide img {
            width: 0.937rem;
            height: 0.937rem;
            vertical-align: middle;
            position: relative;
            top: -0.05rem;
            transition: all .2s linear;
            transform: rotate(0deg);
        }

        .topic .slide img.transform {
            /* transition: all .5s linear; */
            transform: rotate(180deg);
        }

        .label {
            display: inline-block;
            padding: 0.18rem 0.468rem;
            background-color: #fdeeef;
            color: #f25c62;
            border-radius: 0.23rem;
            font-size: 0.609rem;
            letter-spacing: 0.1rem;
        }

        .address {
            align-items: center;
            margin-top: 0.468rem;
        }

        .address img {
            width: 0.75rem;
            height: 0.75rem;
            margin-left: 0.1rem;
            margin-right: 0.28rem;
            position: relative;
            top: -0.1rem;
        }

        .appendBar {
            width: 100%;
            position: fixed;
            align-items: center;
            justify-content: space-around;
            background-color: white;
            padding-bottom: 0.937rem;
            bottom: 0px;
        }

        .appendBar a {
            width: 40%;
            padding: 0.468rem 0;
            text-align: center;
            border-radius: 1.21rem;
            font-size: 0.656rem;
        }

        /* .appendBar a:active {
            color: initial;
        } */
        .exit,
        .exit:active {
            color: #999999;
            border: 0.05rem solid #A5A5A5;
        }

        .publish,
        .publish:active {
            background: #FF6772;
            color: #fff;
        }

        /* 功能列表 */
        .actions-modal-button {
            color: #333;
        }
    </style>
</head>

<body>
    <div class="page">

        <div class="content">
            <!-- <input type="file" mu/ltiple> -->
            <textarea name="invitation" id="" placeholder="记录这一刻的想法..." name="content"></textarea>
            <!-- 图片添加 -->

            <div class="imgs">
                <img src="" hidden>
                <div class="imgAppend">
                    <!-- <img src="" alt="" hidden style="z-index: 10;"> -->
                </div>
                <form action="" id="img">
                    <input type="file" name="img" accept="image/*">
                </form>
            </div>

            <p class="checkLabel">
                <!-- <span class="label"><i>#</i>养护资讯</span> -->
            </p>
            <!-- 话题 -->
            <div class="topic">
                <div class="topicHead line">
                    <img src="https://oss.flowerplus.cn/oss_svg/2019-02-13/15500250733747.svg" alt="">
                    <span>添加话题</span>
                    <span>选择合适的话题能被更多人看到哦</span>
                </div>
                <ul class="topics" name="topics" value>
                    <li class="line">
                        <span>#旅途手记</span>
                        <span>#森林瓜友会 - 打卡领券</span>
                        <span>#养护咨询</span>
                        <span>#今日份美食</span>
                        <span>#心水好物</span>
                        <span>#收花打卡</span>
                        <span>#植物点亮空间</span>
                    </li>
                    <li class="line" hidden>
                        <span>#旅途手记</span>
                        <span>#森林瓜友会 - 打卡领券</span>
                        <span>#养护咨询</span>
                        <span>#今日份美食</span>
                        <span>#心水好物</span>
                        <span>#收花打卡</span>
                        <span>#植物点亮空间</span>
                    </li>
                </ul>
                <p class="slide">展开 <img src="https://oss.flowerplus.cn/oss_svg/2019-07-17/15633290129212.svg" alt="">
                </p>
            </div>
            <!-- 地址 -->
            <div class="address line">
                <img src="https://oss.flowerplus.cn/oss_svg/2019-02-13/15500250735458.svg" alt="">
                <span>显示所在地址</span>
            </div>
        </div>
        <div class="appendBar line">
            <a href="javascript:;" class="exit">存草稿</a>
            <a href="javascript:;" class="publish">发布</a>
        </div>
    </div>
    {{include "./script.html"}}
    <script>
        
        $(function () {
            // console.log($(".imgAppend").find("input").click())
            $(":file").change(function () {
                console.log(1)
                let file = this.files[0];
                $(this).closest(".imgs").find("img").show().attr("src", URL.createObjectURL(file));
                // $(".imgs img").show();
            })
            $(".imgAppend").click(function () {
                var buttons1 = [
                    {
                        text: '图片',
                        onClick: function () {
                            $(":file").click();
                        }
                    },
                    {
                        text: '视频',
                        // color:"#666",
                        onClick: function () {
                            $.alert("该功能没有实现");
                        }
                    },
                    {
                        text: '录制',
                        // color:"#666",
                        onClick: function () {
                            $.alert("该功能没有实现");
                        }
                    }

                ];
                var buttons2 = [
                    {
                        text: '取消',
                    }
                ];
                var groups = [buttons1, buttons2];
                $.actions(groups);
            })
            $(".topics li span").click(function () {
                $(this).closest(".topics").find("span").removeClass("selected");
                $(this).addClass("selected");
                let str = `<span class="label"><i>#</i>${$(this).html().slice(1)}</span>`
                $(".checkLabel").html(str);
            })
            $(".slide").click(function () {
                // console.log(1)
                this.isClick = !this.isClick;
                // console.log( $("topics > li"))
                if (this.isClick) {
                    // $(this).prop()
                    $(".topics > li").eq(1).removeAttr("hidden");
                    $(this).find("img").addClass("transform")
                } else {
                    $(".topics > li").eq(1).attr("hidden", "true");
                    $(this).find("img").removeClass("transform")
                }
            })
            $(document).on("click", ".imgs img", function () {
                var buttons1 = [
                    {
                        text: '删除',
                        color: "danger",
                        onClick: () => {
                            $.alert("删除成功");
                            $(this).hide();
                            $(":file").val("")
                        }
                    }
                ];
                var buttons2 = [
                    {
                        text: '取消',
                        // color:"#666",
                        // bg: ''

                    }
                ];
                var groups = [buttons1, buttons2];
                $.actions(groups);
            })

            $(".publish").click(function () {
                if ($("textarea").val() && $(":file")[0].files[0]) {
                    let data = new FormData($("#img")[0]);
                    data.append("content", $("textarea").val());
                    data.append("label", $(".topics .selected").html() ?  $(".topics .selected").html() : "");
                    data.append("address", "");
                    // data.append("img",$(":file")[0].files[0]);
                    $.ajax({
                        method: "post",
                        url: "/discovery/appendTopic",
                        data: data,
                        processData: false,
                        contentType: false
                    }).done(data => {
                        $.alert(data.msg, () => {
                            if (data.coder) {
                                history.back();
                            }
                        });

                    })
                } else {
                    $.alert("请发布内容和图片");
                }

            })

        })
    </script>
</body>

</html>
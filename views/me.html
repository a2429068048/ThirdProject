<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的主页</title>
    {{include "./commend.html"}}
    <style>
        .top {
            /* min-height: ; */
            background-image: url(https://oss.flowerplus.cn/oss_jpg/2019-03-01/15514334642699.jpg!750);
            background-size: cover;
            background-position: center center;
            padding: 0;
        }

        .headerMask {
            width: 100%;
            padding: 0.468rem;
            background-color: rgba(0, 0, 0, .3);
            min-height: 12.33rem;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .headerMask p {
            margin: 0;
        }

        .header {
            justify-content: space-between;
            /* align-items: flex-start; */
            padding-top: 0.937rem;
        }

        .header .left {
            text-align: center;
        }

        .header .left img {
            width: 2.344rem;
            height: 2.344rem;
            border-radius: 50%;
        }

        .header .left p {
            padding-left: 0.656rem;
            font-size: 0.750rem;
            margin-top: 0.468rem;
        }

        .header .left .level {
            font-size: 0.656rem;
            color: orange;
            margin-left: 0.19rem;
        }

        .header .right {
            font-size: 0.56rem;
        }

        .header .right a {
            color: white;
        }

        .header .right p {
            padding: 0.281rem 1.22rem;
            border: 0.05rem solid white;
            border-radius: 0.750rem;

        }

        .header .right img {
            width: 0.468rem;
            margin-right: 0.281rem;
        }

        .menu {
            justify-content: space-around;
            text-align: center;
            font-size: 0.750rem;
        }

        .menu a {
            color: white;
        }

        .menu p {
            font-size: 0.56rem;
        }

        .nav-head {
            justify-content: space-around;
            background-color: white;
            font-size: 0.750rem;
        }

        .nav-head span {
            display: inline-block;
            padding: 0.468rem 0.19rem 7px;
            vertical-align: middle;
            border-bottom: 0.15rem solid transparent;
        }

        .nav-head li.active span {
            border-bottom-color: #FF6772;
        }

        .contentBody {
            font-size: 0.61rem;
            text-align: center;
            color: #C3C5C6;
        }

        .contentBody img {
            width: 2.81rem;
            margin-bottom: 0.656rem;
        }

        .noInfo {
            padding-top: 2.344rem;
        }

        .info {
            justify-content: space-between;
            flex-wrap: wrap;
            padding: 0 0.468rem;
        }

        .info p {
            margin: 0;
            padding: 0;
            text-align: left;
            padding: 0 0.468rem;
            color: black;
        }

        .info>div {
            flex-basis: 48%;
            border-radius: 0.468rem;
            overflow: hidden;
            margin: 0.468rem 0;
        }

        .card-footer {
            display: flex;
            align-items: center;
        }

        .card-footer a.link {
            color: black;

        }

        .card-footer img {
            width: 0.937rem;
            height: 0.937rem;
            border-radius: 50%;
            margin: 0;
            margin-right: 0.468rem;
        }

        .card-footer {
            font-size: 0.56rem;
        }

        .card-cover {
            height: 5.625rem;
        }

        .card-footer .good img {
            margin-right: 0.19rem;
            border-radius: 0;
            width: 0.750rem;
            height: 0.750rem;
            vertical-align: middle;
            position: relative;
            top: -0.1rem;
        }
    </style>
    <script>
        function picError(img) {
            img.src = "https://oss.flowerplus.cn/oss_png/2019-05-23/15585981426066.png!57_57";
        }
    </script>
</head>

<body>
    <div class="page" data-id="{{_id}}">
        {{include "./disBartab.html"}}
        <header class="top" style="background-image: url({{img}});">
            <div class="headerMask">
                <div class="header line">
                    <div class="left">
                        <img src="{{pic}}" alt="" onerror="picError(this)">
                        <p>{{name}}<span class="level">Lv1</span></p>
                    </div>
                    <div class="right">
                        <a href="/discovery/disEdit">
                            <p><img src="https://oss.flowerplus.cn/oss_svg/2019-02-19/15505426447364.svg"></inm>编辑</p>
                        </a>
                    </div>
                </div>
                <ul class="menu line">
                    <li>
                        <a href="/discovery/myfolow" class="myfolow">
                            <span>{{like ? like.length : 0}}</span>
                            <p>我关注的人</p>
                        </a>
                    </li>
                    <li>
                        <a href="/discovery/flowme">
                            <span>{{flowme ? flowme.length : 0}}</span>
                            <p>关注我的人</p>
                        </a>

                    </li>
                    <li>
                        <span>{{getGoods? getGoods : 0}}</span>
                        <p>获赞和收藏</p>
                    </li>
                </ul>
            </div>
            <ul class="nav-head line">
                <li class="active" data-type="topic" dasta-id="_id"><span>帖子</span><small>(0)</small></li>
                <li data-type="collect" dasta-id="_id"><span>收藏</span><small>({{topics ? topics.length : 0}})</small></li>
            </ul>
        </header>
        <div class="content">
            <div class="contentBody">
                <section class="topic">
                    <div class="noInfo">
                        <img src="https://oss.flowerplus.cn/oss_svg/2019-03-01/15514287051119.svg" alt="">
                        <p>点击下方的"+", 发布你的第一篇帖子吧</p>
                    </div>
                    <div class="info line">
                        <!-- <div class="card demo-card-header-pic">
                            <div valign="bottom" class="card-header color-white no-border no-padding">
                                <img class='card-cover' src="/topics/1606300148044tong.jpeg" alt="">
                            </div>
                            <div class="card-content">
                                <p>则是内容</p>
                            </div>
                            <div class="card-footer">
                                <a href="#" class="link">
                                    <img src="/topics/1606300148044tong.jpeg" alt="">
                                    <span>用户名</span>
                                </a>
                                <a href="#" class="link good">
                                    <div>
                                        <img src="https://oss.flowerplus.cn/oss_svg/2019-01-18/15478023156349.svg"
                                            alt="">
                                    </div>
                                    <span>1</span>
                                </a>
                            </div>
                        </div> -->
                    </div>
                </section>
                <section class="collect" hidden>
                    <div class="noInfo">
                        <img src="https://oss.flowerplus.cn/oss_svg/2019-03-01/15514287126935.svg" alt="">
                        <p>收藏夹空空如也</p>
                    </div>
                    <div class="info line"></div>
                </section>
            </div>
        </div>
    </div>
    {{include "./script.html"}}
    <script>
        // 判断是否登录了
        if (!$.cookie("username")) {
            $.alert("请先登录", () => {
                location.href = "/login";
            })
        }
        let id = $(".page").data("id").replaceAll("\"", "");
        // 发送获得帖子的请求
        getMessage("topic");
        function getMessage(target) {
            $.get(`/discovery/${target}?id=${id}`, data => {
                // console.log(data.data)
                console.log(data.data,target);
                if (data.data.length) {
                    $(`.${$(".nav-head .active").data("type")}`).find(".noInfo").hide()
                    $("li.active small").html(`(${data.data.length})`)
                    let str = "";
                    data.data.forEach(item => {
                        str += `
                        <div class="card demo-card-header-pic">
                            <div valign="bottom" class="card-header color-white no-border no-padding">
                                <img class='card-cover'
                                    src="/topics/${item.img}"
                                    alt="">
                            </div>
                            <div class="card-content">
                                <p>${item.content}</p>
                            </div>
                            <div class="card-footer">
                                <a href="#" class="link">
                                    <img src="${item.pic}" alt="">
                                    <span>${item.name}</span>
                                </a>
                                <a href="#" class="link good" data-id="${item._id}">
                                    <div class="${item.status ? "checked" : ""}">
                                        <img src="https://oss.flowerplus.cn/oss_svg/2019-01-18/15478023156349.svg" alt="" ${item.status ? "" : "hidden"}>
                                        <img src="https://oss.flowerplus.cn/oss_svg/2019-01-18/15478023154317.svg" alt="" ${item.status ? "hidden" : ""}>
                                    </div>
                                    <span>${item.getGoods ? item.getGoods.length : 0}</span>
                                </a>
                            </div>
                        </div>
                        
                        `
                    });
                    // console.log($("li.active").data("type"))
                    // console.log(str);
                    $(`.${$(".nav-head .active").data("type")}`).find(".info").html(str);
                } else {
                    console.log(1)
                    $(`.${$(".nav-head .active").data("type")}`).find(".noInfo").show();
                }
            })
        }
        // 绑定事件
        $(document).on("click", ".good", function () {
            console.log(1);
            $(this).find("img").toggle();
            let good = $(this).find("span").text() * 1;
            let nums = $(".menu li").eq(2).find("span").text().trim() * 1;
            $(this).find("span").text($(this).find("div").hasClass("checked")  ? --good : ++good);
            $(".menu li").eq(2).find("span").text($(this).find("div").hasClass("checked") ? --nums : ++nums);
            // 发送请求
            // 添加或者取消点赞
            $.get(`/discovery/${$(this).find("div").hasClass("checked") ? "removeGood" : "addGood"}?id=${$(this).data("id")}`, data => {
                console.log(data);
            })
            $(this).find("div").toggleClass("checked");
        })
        $(function () {
            $(".content").css("top", $(".top").innerHeight());

            $(".nav-head li").click(function () {

                // console.log(1)
                $(this).addClass("active").siblings().removeClass("active");
                $.showIndicator();
                setTimeout(() => {
                    $(`.${$(this).data("type")}`).show().siblings().hide();
                    getMessage($(this).data("type"));
                    $.hideIndicator();
                }, 2000);
            });

        })
    </script>
</body>

</html>